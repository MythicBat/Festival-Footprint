<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üéµ Music Festival Footprint: Where Australia Grooves</title>

  <!-- Styles -->
  <link rel="stylesheet" href="css/style.css" />

  <!-- Vega Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
</head>

<body>
  <div class="parallax">
    <div class="layer layer-back"></div>
    <div class="layer layer-mid"></div>
    <div class="layer layer-front"></div>
  </div>

  <header class="wrap">
    <h1>üéµ Music Festival Footprint: Where Australia Grooves</h1>
    <p class="subtitle">
      Explore where festivals cluster, when the season peaks, which genres dominate, and how climate shapes planning.
    </p>
    
    <!-- Filter Panel -->
    <div class="filter-panel">
      <label>üéõ State:</label>
      <select id="stateFilter">
        <option value="">All</option>
        <option>ACT</option>
        <option>NSW</option>
        <option>NT</option>
        <option>QLD</option>
        <option>SA</option>
        <option>TAS</option>
        <option>VIC</option>
        <option>WA</option>
      </select>

      <label>üéö Genre:</label>
      <select id="genreFilter">
        <option value="">All</option>
        <option>Electronic</option><option>Rock</option><option>Country</option>
        <option>Indie</option><option>Folk</option><option>Blues</option>
        <option>Hip-hop</option><option>Jazz</option><option>Classical</option>
        <option>R&B</option><option>Reggae</option><option>Metal</option>
        <option>Pop</option><option>Alternative</option><option>Mixed</option>
        <option>Other</option>
      </select>
    </div>
  </header>

  <main class="wrap">
    <!-- Row 1: Map -->
    <section class="grid">
      <div class="col-2 chart wide">
        <h2>Festivals by State/Territory</h2>
        <div id="map"></div>
        <p class="note">
          <strong>Australia's festival heartbeat:</strong>
          From the sun-soaked shores of Byron Bay to the laneways of Melbourne, Australia's music festivals reflect the nation's diverse spirit and geography.  
          Each state nurtures its own rhythm ‚Äî New South Wales and Victoria draw the biggest crowds with internationally renowned events, while Queensland's subtropical vibe fuels open-air beach festivals.  
          In the west, Perth and Fremantle mix indie and surf-rock under blazing sunsets, while the Northern Territory hosts smaller, culture-rich gatherings celebrating Indigenous music and art.  
          Australia's vast landscape ‚Äî from deserts to coastlines ‚Äî shapes not only sound but also timing: spring and summer bring the main festival wave, making the nation groove from September to March.
        </p>
      </div>
    </section>

    <!-- Row 2: Genres and Climate -->
    <section class="grid">
      <div class="col-1 chart">
        <h2>Genre Mix</h2>
        <div id="genres"></div>
        <p class="note">
          <strong>The Soundtrack of a Nation:</strong>  
          Australia's festival stages tell a story of energy and evolution.  
          <strong>Electronic</strong> and <strong>Rock</strong> lead the charts ‚Äî drawing massive, youthful crowds under strobe lights and open skies.  
          <strong>Country</strong> and <strong>Indie</strong> reflect regional roots and emerging artists, while <strong>Folk</strong> and <strong>Blues</strong> preserve the nation's storytelling traditions.  
          Across genres, Australian festivals celebrate both global trends and homegrown sounds ‚Äî proof that creativity thrives in every corner of the continent.
        </p>
      </div>
      <div class="col-1 chart">
        <h2>Genre x State</h2>
        <div id="matrix"></div>
        <p class="note">
          <strong>How styles spread:</strong>
          Larger circles show where a genre is especially active. Use the filters above to
          compare a single state or spotlight a genre's regional footprint.
        </p>
      </div>
    </section>

    <section class="chart-block">
      <h2>üéñÔ∏è Top Festival Capitals Leaderboard</h2>
      <div id="leaderboard"></div>
      <p class="note">
        This animated leaderboard reveals how Australia‚Äôs urban music scenes evolve year-by-year.  
        Sydney and Melbourne continue their healthy rivalry for the festival crown, 
        while Brisbane and Perth steadily grow their footprints ‚Äî proof that live music culture is thriving across the nation.
      </p>
    </section>

    <!-- Row 4: Radial Calendar and Festival Sweet Spot -->
    <section class="grid grid-2">
      <div class="col-1 chart">
        <h2>Festival Seasonality</h2>
        <div id="radial"></div>
        <p class="note">
          Australia's music calendar rises and falls with the seasons ‚Äî a cycle as natural as the weather itself.  
          <strong>Spring and summer</strong> (October-March) mark the peak, filled with major headliners and open-air spectacles.  
          As autumn cools the coasts, festivals move inland with more intimate settings, and by <strong>winter</strong>, the rhythm softens into small-town gigs and indoor showcases.  
          Come September, the volume rises again, ushering in another year of sound, sunshine, and shared experience.
        </p>
      </div>
      <div class="col-1 chart">
        <h2>Festival Climate Sweet Spot</h2>
        <div id="overlay"></div>
        <p class="note">
          <strong>Finding the Sweet Spot:</strong>  
          Every city dreams of that perfect festival day ‚Äî warm enough for open-air stages, cool enough to dance, and dry enough for the crowd to stay till the encore.  
          This chart reveals the **climate comfort zones** that define Australia's festival calendar.  
          Capitals like <strong>Melbourne</strong>, <strong>Sydney</strong>, and <strong>Adelaide</strong> strike a near-perfect balance between **20-28 ¬∞C** with moderate rainfall, aligning with the festival boom from **November to March**.  
          Meanwhile, <strong>Darwin</strong> and <strong>Brisbane</strong> shine earlier in the season before tropical rains arrive.  
          The pattern is clear ‚Äî the rhythm of the weather sets the rhythm of the nation, proving that climate isn't just a backdrop, it's part of the performance.
        </p>
      </div>
    </section>

    <section class="grid">
      <div class="chart">
        <h2>Festival Race (States)</h2>
        <div id="race"></div>
        <p class="note">
          <strong>The Race for Rhythm:</strong>  
          As Australia's live music scene evolved through the decade, each state raced for festival dominance.  
          <strong>Victoria</strong> and <strong>New South Wales</strong> consistently led the charge ‚Äî powered by
          world-class events and iconic venues ‚Äî while <strong>Queensland</strong> and <strong>Western Australia</strong>
          steadily climbed with growing regional line-ups.  
          The dramatic dip around <strong>2020‚Äì2021</strong> mirrors the pandemic's pause on gatherings, yet
          by <strong>2023</strong> the nation roared back to life, restoring festival energy across every coast.
        </p>
      </div>
    </section>

    <!-- Insights Section -->
    <section class="insights">
      <h2>Key Insights</h2>
      <ul>
        <li><strong>NSW</strong> and <strong>VIC</strong> dominate Australia‚Äôs festival scene, followed by Queensland.</li>
        <li>Festival season peaks between <strong>October‚ÄìMarch</strong>, aligning with the warmer months.</li>
        <li><strong>Electronic</strong> and <strong>Rock</strong> genres lead the pack, reflecting modern tastes.</li>
        <li>Optimal festival weather sits around <strong>20‚Äì30 ¬∞C</strong> and under <strong>120 mm rainfall</strong>.</li>
      </ul>
    </section>
  </main>

  <footer class="wrap footer">
    <small>¬© 2025 Alin Merchant ‚Ä¢ Data: Creative Australia (Soundcheck) & BoM ‚Ä¢ Built with Vega-Lite</small>
  </footer>

  <!-- Embeds -->
  <script>
    let mapView=null, genresView=null, climateView=null, radialView=null, overlayView=null, raceView=null, matrixView=null, leaderboardView=null, autoplayTimer;
    
    // Embed charts
    vegaEmbed("#map", "specs/map_state_choropleth.json", {action: false})
    .then(res => {
      mapView=res.view;
      // click -> set dropdown
      res.view.addSignalListener("stateSel", (_,v) => {
        const st=v && v.values && v.values[0]?v.values[0]:null;
        const abbrMap = {
          "New South Wals": "NSW", "Victoria": "VIC", "Queensland": "QLD",
          "Weatern Australia": "WA", "South Australia": "SA", "Tasmania": "TAS",
          "Northern Territory": "NT", "Australian Capital Territory": "ACT"
        };
        document.getElementById("stateFilter").value = st?abbrMap[st]:"";
        pushFilters();
      });
    });

    vegaEmbed("#genres", "specs/genres_by_state.json", {action:false}).then(r => genresView=r.view);
    vegaEmbed("#radial", "specs/radial_calendar.json", {action:false}).then(r => radialView=r.view);
    vegaEmbed("#overlay", "specs/festival_climate_overlay.json", {action:false}).then(r => overlayView=r.view);
    vegaEmbed("#race", "specs/race_by_state.json", {action:false}).then(r => raceView=r.view);
    vegaEmbed("#matrix", "specs/genre_state_bubbles.json", {action:false}).then(r => matrixView=r.view);
    vegaEmbed("#leaderboard", "specs/festival_capitals_race.json", {action:false}).then(
      res => {
        leaderboardView = res.view;

        startLeaderBoardAutoplay();
      }
    );

    function startLeaderBoardAutoplay() {
      clearInterval(autoplayTimer);
      let y = 2019;
      autoplayTimer = setInterval(() => {
        // read current in case user moved the slider
        try { y = leaderboardView.signal("yearSelect"); } catch(e) {}
        const next = (y >= 2023) ? 2019 : (y + 1);
        leaderboardView.signal("yearSelect", next).run();
        y = next;
      }, 1200);   // 1.2s per year
    }

    document.querySelector("#leaderboard").addEventListener("mouseenter", () => clearInterval(autoplayTimer));
    document.querySelector("#leaderboard").addEventListener("mouseleave", startLeaderBoardAutoplay);

    setInterval(() => {
      if (!raceView) return;
      const cur = raceView.signal("yr");
      const next = cur >= 2023 ? 2016 : cur + 1;
      raceView.signal("yr", next).run();
    }, 1400);

    // Push dropdown values into all charts
    function pushFilters() {
      const st = document.getElementById("stateFilter")?.value || "";
      const gn = document.getElementById("genreFilter")?.value || "";
      [genresView, climateView, radialView, overlayView, matrixView].forEach(v => {
        if (!v) return;
        try{v.signal("uiState",st).run();} catch{}
        try{v.signal("uiGenre",gn).run();} catch{}
      });
    }
    document.getElementById("stateFilter").onchange=pushFilters;
    document.getElementById("genreFilter").onchange=pushFilters;

    // Parallax drfit on mouse move
    document.addEventListener("mousemove", e => {
      const { innerWidth:w, innerHeight:h } = window;
      const x = (e.clientX / w - 0.5) * 2;
      const y = (e.clientY / h - 0.5) * 2;

      document.querySelectorAll(".layer").forEach((el, i) => {
        const depth = (i+1) * 10; // adjust speed by layer
        el.style.transform = `translate(${x * depth}px, ${y * depth}px) scale(1.05)`;
      });
    });

    // Slow automatic drift when idle
    let angle = 0;
    setInterval(() => {
      angle += 0.002;
      document.querySelectorAll(".layer").forEach((el, i) => {
        const depth = (i+1)*4;
        el.style.transform = `translate(${Math.sin(angle)*depth}px, ${Math.cos(angle)*depth}px) scale(1.05)`;
      });
    }, 50);
  </script>
</body>
</html>