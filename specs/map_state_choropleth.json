{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width": 800,
  "height": 520,
  "title": "Australian Music Festivals by State/Territory (FY2022â€“23)",
  "view": {"stroke": null},
  "projection": {"type": "equirectangular", "center":[134, -26], "scale": 950},
  "layer": [
    {
      "data": {
        "url": "geo/au_states_2021.topo.json",
        "format": {"type": "topojson", "feature": "STE_2021_AUST_GDA2020"}
      },
      "transform": [
        { "calculate": "datum.properties.STE_NAME21", "as": "state_full" },
        {
          "calculate": "datum.state_full == 'Australian Capital Territory' ? 'ACT' : datum.state_full == 'New South Wales' ? 'NSW' : datum.state_full == 'Northern Territory' ? 'NT' : datum.state_full == 'Queensland' ? 'QLD' : datum.state_full == 'South Australia' ? 'SA' : datum.state_full == 'Tasmania' ? 'TAS' : datum.state_full == 'Victoria' ? 'VIC' : datum.state_full == 'Western Australia' ? 'WA' : null",
          "as": "state_abbr"
        },
        {
          "lookup": "state_full",
          "from": {
            "data": {"url": "data/festivals_by_state_2022_23.csv"},
            "key": "state_territory",
            "fields": ["festival_count"]
          },
          "as": "fc_full"
        },
        {
          "lookup": "state_abbr",
          "from": {
            "data": {"url": "data/festivals_by_state_2022_23.csv"},
            "key": "state_territory",
            "fields": ["festival_count"]
          },
          "as": "fc_abbr"
        },
        {
          "calculate": "isValid(datum.fc_full) ? datum.fc_full : (isValid(datum.fc_abbr) ? datum.fc_abbr : 0)",
          "as": "festival_count_filled"
        }
      ],
      "params": [
        {
          "name": "stateSel",
          "select": {"type": "point", "fields": ["state_full"] }
        }
      ],
      "mark": {"type": "geoshape", "stroke": "#BDBDBD", "strokeWidth": 0.6},
      "encoding": {
        "color": {
          "field": "festival_count_filled",
          "type": "quantitative",
          "title": "Festival count",
          "scale": {"scheme": "blues"}
        },
        "opacity": {
          "condition": {"param": "stateSel", "empty": false, "value": 1},
          "value": 0.45
        },
        "tooltip": [
          {"field": "state_full", "title": "State/Territory"},
          {"field": "state_abbr", "title": "Abbrev"},
          {"field": "festival_count_filled", "title": "Festival count"}
        ]
      }
    },
    {
      "data": {
        "url": "geo/au_states_2021.topo.json",
        "format": {"type": "topojson", "feature": "STE_2021_AUST_GDA2020"}
      },
      "transform": [
        { "calculate": "datum.properties.STE_NAME21", "as": "state_full" },
        {
          "calculate":
            "datum.state_full == 'Western Australia' ? 122 : datum.state_full == 'Northern Territory' ? 133 : datum.state_full == 'South Australia' ? 136 : datum.state_full == 'Queensland' ? 145 : datum.state_full == 'New South Wales' ? 147 : datum.state_full == 'Victoria' ? 144.5 : datum.state_full == 'Tasmania' ? 146.8 : datum.state_full == 'Australian Capital Territory' ? 149.1 : 134",
          "as": "cx"
        },
        {
          "calculate":
            "datum.state_full == 'Western Australia' ? -26 : datum.state_full == 'Northern Territory' ? -19 : datum.state_full == 'South Australia' ? -30 : datum.state_full == 'Queensland' ? -20 : datum.state_full == 'New South Wales' ? -32 : datum.state_full == 'Victoria' ? -37 : datum.state_full == 'Tasmania' ? -42.1 : datum.state_full == 'Australian Capital Territory' ? -35.4 : -26",
          "as": "cy"
        },
        {
          "calculate":
            "datum.state_full == 'Australian Capital Territory' ? 'ACT' : datum.state_full == 'New South Wales' ? 'NSW' : datum.state_full == 'Northern Territory' ? 'NT' : datum.state_full == 'Queensland' ? 'QLD' : datum.state_full == 'South Australia' ? 'SA' : datum.state_full == 'Tasmania' ? 'TAS' : datum.state_full == 'Victoria' ? 'VIC' : datum.state_full == 'Western Australia' ? 'WA' : ''",
          "as": "abbr"
        }
      ],
      "mark": {
        "type": "text",
        "fontSize": 14,
        "fontWeight": "bold",
        "color": "black"
      },
      "encoding": {
        "longitude": {"field": "cx", "type": "quantitative"},
        "latitude": {"field": "cy", "type": "quantitative"},
        "text": {"field": "abbr"}
      }
    },
    {
      "data": {"graticule": {"step": [30, 30]}},
      "mark": {"type": "geoshape", "stroke": "#D5D5D5", "fill": null}
    },
    {
      "data": {"sphere": true},
      "mark": {"type": "geoshape", "fill": null, "stroke": "#9EC6FF", "strokeWidth": 0.75}
    }
  ]
}
